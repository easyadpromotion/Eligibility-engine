<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DSA Portal Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #004a99; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: white; padding: 40px; border-radius: 12px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        h2 { color: #004a99; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* Button Styling */
        button { background: #004a99; color: white; width: 100%; padding: 12px; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:hover { background: #003377; }
        button:active { transform: scale(0.98); } /* Click effect */

        .switch-link { margin-top: 15px; font-size: 14px; color: #666; cursor: pointer; display: block; }
        .switch-link:hover { text-decoration: underline; color: #004a99; }
        
        /* Message Styling */
        #message { margin-top: 15px; font-size: 14px; font-weight: bold; min-height: 20px; }
    </style>
</head>
<body>

<div class="login-card" id="loginForm">
    <h2>üîí DSA Login</h2>
    <input type="text" id="loginUser" placeholder="Username" autocomplete="off">
    <input type="password" id="loginPass" placeholder="Password">
    
    <button type="button" onclick="login()">Login</button>
    
    <span class="switch-link" onclick="toggleForms()">New DSA? Register Here</span>
    <div id="loginMsg" style="margin-top:15px; color:red; font-weight:bold;"></div>
</div>

<div class="login-card" id="registerForm" style="display:none">
    <h2>üìù DSA Registration</h2>
    <input type="text" id="regUser" placeholder="Choose Username" autocomplete="off">
    <input type="password" id="regPass" placeholder="Choose Password">
    
    <button type="button" onclick="register()">Request Access</button>
    
    <span class="switch-link" onclick="toggleForms()">Back to Login</span>
    <div id="regMsg" style="margin-top:15px; color:green; font-weight:bold;"></div>
</div>

<script>
    // 1. SWITCH FORMS (Login <-> Register)
    function toggleForms() {
        const login = document.getElementById('loginForm');
        const reg = document.getElementById('registerForm');
        
        // Clear messages when switching
        document.getElementById('loginMsg').innerText = "";
        document.getElementById('regMsg').innerText = "";

        if (login.style.display === 'none') {
            login.style.display = 'block'; 
            reg.style.display = 'none';
        } else {
            login.style.display = 'none'; 
            reg.style.display = 'block';
        }
    }

    // 2. REGISTER FUNCTION
    function register() {
        const user = document.getElementById('regUser').value.trim();
        const pass = document.getElementById('regPass').value.trim();
        const msg = document.getElementById('regMsg');

        if(!user || !pass) { 
            msg.innerText = "‚ö†Ô∏è Please enter Username & Password";
            msg.style.color = "orange";
            return; 
        }

        let users = JSON.parse(localStorage.getItem('dsaUsers')) || [];
        
        // Check if username exists
        if(users.find(u => u.username === user)) { 
            msg.innerText = "‚ùå Username already taken!";
            msg.style.color = "red";
            return; 
        }

        // Save User
        users.push({ username: user, password: pass, status: 'Pending' });
        localStorage.setItem('dsaUsers', JSON.stringify(users));

        // Success Message
        msg.innerText = "‚úÖ Request Sent! Wait for Admin Approval.";
        msg.style.color = "green";
        
        // Wait 2 seconds, then switch to login screen
        setTimeout(() => {
            toggleForms();
            document.getElementById('loginMsg').innerText = "‚úÖ Account Created. Please wait for Admin approval.";
            document.getElementById('loginMsg').style.color = "green";
        }, 2000);
    }

    // 3. LOGIN FUNCTION
    function login() {
        const user = document.getElementById('loginUser').value.trim();
        const pass = document.getElementById('loginPass').value.trim();
        const msg = document.getElementById('loginMsg');

        let users = JSON.parse(localStorage.getItem('dsaUsers')) || [];
        const validUser = users.find(u => u.username === user && u.password === pass);

        if (!validUser) {
            msg.innerText = "‚ùå Invalid Username or Password";
            msg.style.color = "red";
        } else if (validUser.status === 'Pending') {
            msg.innerText = "‚è≥ Account Pending Admin Approval";
            msg.style.color = "#ff9800"; // Orange
        } else if (validUser.status === 'Rejected') {
            msg.innerText = "üö´ Access Denied by Admin";
            msg.style.color = "red";
        } else {
            // SUCCESS
            sessionStorage.setItem('currentUser', user);
            msg.innerText = "‚úÖ Login Successful! Redirecting...";
            msg.style.color = "green";
            
            // Redirect after 1 second
            setTimeout(() => {
                window.location.href = "user-app.html";
            }, 1000);
        }
    }
</script>

</body>
</html>