<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Engine Pro - Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. LAYOUT STYLES --- */
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        
        /* LEFT SIDEBAR */
        .sidebar { width: 240px; background-color: #1a237e; color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 4px 0 10px rgba(0,0,0,0.1); z-index: 10; flex-shrink: 0; }
        .logo { font-size: 20px; font-weight: bold; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px; margin-bottom: 8px; cursor: pointer; border-radius: 6px; transition: 0.2s; font-size: 14px; }
        .nav-item:hover { background-color: #3949ab; }
        .nav-item.active { background-color: #3949ab; border-left: 4px solid #ffeb3b; }
        .logout { margin-top: auto; background-color: #d32f2f; padding: 12px; text-align: center; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* MAIN WRAPPER */
        .main-wrapper { flex: 1; display: flex; overflow: hidden; }
        
        /* CENTER: FORM AREA */
        .form-area { flex: 1; padding: 30px; overflow-y: auto; }
        
        /* RIGHT: POLICY PANEL */
        .right-panel { width: 300px; background: white; border-left: 1px solid #ddd; padding: 20px; overflow-y: auto; box-shadow: -2px 0 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .panel-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; border-bottom: 2px solid #1a237e; padding-bottom: 5px; }
        
        .policy-mini-card { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 10px; font-size: 12px; }
        .policy-mini-card strong { color: #1a237e; display: block; margin-bottom: 5px; font-size: 13px; text-transform: uppercase; }
        .mini-stat { display: flex; justify-content: space-between; margin-bottom: 3px; color: #555; }

        /* --- 2. FORM STYLES --- */
        .accordion { background: white; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #e0e0e0; }
        .accordion-header { padding: 15px 20px; font-weight: 600; color: #1a237e; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .accordion-body { padding: 20px; display: none; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; }
        
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .form-group { margin-bottom: 5px; }
        label { display: block; margin-bottom: 6px; font-size: 12px; color: #555; font-weight: 500; }
        input, select { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; box-sizing: border-box; }
        
        .hidden-field { display: none; }
        
        /* Bank Buttons */
        .bank-options { display: flex; gap: 8px; flex-wrap: wrap; }
        .bank-opt { padding: 6px 12px; border: 1px solid #ddd; border-radius: 15px; cursor: pointer; font-size: 12px; user-select: none; }
        .bank-opt.selected { background-color: #1a237e; color: white; border-color: #1a237e; }

        .submit-btn { width: 100%; padding: 16px; background-color: #2e7d32; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.3); }
        .submit-btn:hover { background-color: #1b5e20; }
        
        .report-btn { width: 100%; padding: 12px; background-color: #0288d1; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; display: none; }

        /* RESULTS AREA */
        #resultsArea { margin-top: 30px; }
        
        /* --- 3. PDF REPORT STYLES (Hidden Modal) --- */
        #fullReportModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .report-paper { background: white; width: 800px; margin: 0 auto; padding: 40px; box-shadow: 0 0 20px rgba(0,0,0,0.5); font-family: 'Arial', sans-serif; min-height: 1000px; }
        
        .report-header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .report-title { font-size: 24px; font-weight: bold; text-transform: uppercase; text-decoration: underline; color: #000; }
        .report-section-title { background: #eee; padding: 8px; font-weight: bold; font-size: 14px; border-left: 4px solid #333; margin-bottom: 10px; margin-top: 20px; }
        
        .details-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 12px; }
        .detail-item { border-bottom: 1px dotted #ccc; padding-bottom: 2px; }
        .detail-label { font-weight: bold; color: #555; }

        .report-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 12px; }
        .report-table th, .report-table td { border: 1px solid #333; padding: 8px; text-align: left; }
        .report-table th { background-color: #f0f0f0; font-weight: bold; }
        .status-declined { color: #d32f2f; font-weight: bold; }

        @media print {
            body > * { display: none !important; }
            #fullReportModal { display: block !important; position: absolute; top: 0; left: 0; background: white; width: 100%; height: auto; padding: 0; margin: 0; z-index: 9999; }
            .report-paper { box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 20px; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">ðŸš€ Credit Engine</div>
        <div class="nav-item active">ðŸ“„ New Application</div>
        <div class="nav-item">ðŸ“Š Dashboard</div>
        <div class="logout">ðŸšª Logout</div>
    </div>

    <div class="main-wrapper">
        
        <div class="form-area">
            <h2 style="color:#333; margin-top:0;">New Loan Application</h2>
            
            <div class="accordion">
                <div class="accordion-header" onclick="toggleSection('sec1')">1. Business Details <span>â–¼</span></div>
                <div id="sec1" class="accordion-body open">
                    <div class="form-grid">
                        <div class="form-group"><label>Customer/Business Name</label><input type="text" id="bizName" class="pdf-data" data-label="Business Name"></div>
                        <div class="form-group"><label>Vintage (Years)</label><input type="number" id="vintage" class="pdf-data" data-label="Vintage"></div>
                        <div class="form-group"><label>Turnover (â‚¹ Lakhs)</label><input type="number" id="turnover" class="pdf-data" data-label="Turnover"></div>
                        <div class="form-group"><label>Entity Type</label>
                            <select id="entityType" class="pdf-data" data-label="Entity"><option>Proprietorship</option><option>Partnership</option><option>Pvt Ltd</option><option>LLP</option></select>
                        </div>
                        <div class="form-group"><label>Business Sector</label>
                            <select id="sector" class="pdf-data" data-label="Sector">
                                <option value="Trading">Trading (7% Margin)</option>
                                <option value="Manufacturing">Manufacturing (9% Margin)</option>
                                <option value="Service">Service (11% Margin)</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Premises Type</label><select id="premises" class="pdf-data" data-label="Premises"><option>Owned</option><option>Rented</option><option>Leased</option></select></div>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleSection('sec2')">2. Banking & Docs <span>â–¼</span></div>
                <div id="sec2" class="accordion-body">
                    <div class="form-grid">
                        <div class="form-group"><label>ABB (Avg Balance) â‚¹</label><input type="number" id="abb" class="pdf-data" data-label="ABB"></div>
                        <div class="form-group">
                            <label>Bank Statements Available</label>
                            <div class="bank-options">
                                <div class="bank-opt" onclick="toggleBankOpt(this)">SA</div>
                                <div class="bank-opt" onclick="toggleBankOpt(this)">CA</div>
                                <div class="bank-opt" onclick="toggleBankOpt(this)">OD</div>
                                <div class="bank-opt" onclick="toggleBankOpt(this)">CC</div>
                            </div>
                        </div>
                        <div class="form-group"><label>GST Registered?</label>
                            <select id="gstReg" class="pdf-data" data-label="GST Reg" onchange="toggleField('gstDetails', this.value === 'Yes')"><option>No</option><option>Yes</option></select>
                        </div>
                        <div class="form-group hidden-field" id="gstDetails"><label>GST Number</label><input type="text" class="pdf-data" data-label="GST No"></div>
                        
                        <div class="form-group"><label>ITR Filed?</label>
                            <select id="itrReg" class="pdf-data" data-label="ITR Filed" onchange="toggleField('itrDetails', this.value === 'Yes')"><option>No</option><option>Yes</option></select>
                        </div>
                        <div class="form-group hidden-field" id="itrDetails"><label>ITR Amount</label><input type="number" class="pdf-data" data-label="ITR Amt"></div>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleSection('sec3')">3. Credit Profile <span>â–¼</span></div>
                <div id="sec3" class="accordion-body">
                    <div class="form-grid">
                        <div class="form-group"><label>CIBIL Score</label><input type="number" id="cibil" class="pdf-data" data-label="CIBIL"></div>
                        <div class="form-group"><label>Active Loans</label><input type="number" id="activeLoans" class="pdf-data" data-label="Active Loans"></div>
                        <div class="form-group"><label>Monthly EMI (â‚¹)</label><input type="number" id="monthlyEmi" class="pdf-data" data-label="EMI"></div>
                        <div class="form-group"><label>Unsecured Loans</label><input type="number" id="unsecLoans" class="pdf-data" data-label="Unsec Loans"></div>
                        <div class="form-group"><label>Loans Taken (6m)</label><input type="number" id="loansTaken6m" class="pdf-data" data-label="Loans (6m)"></div>
                        <div class="form-group"><label>Loans Closing (6m)</label><input type="number" id="loansClosed6m" class="pdf-data" data-label="Closing (6m)"></div>
                        <div class="form-group"><label>Reduced EMI (6m)</label><input type="number" id="reducedEmi" class="pdf-data" data-label="Reduced EMI"></div>
                        <div class="form-group"><label>Enquiries (3m)</label><input type="number" id="enquiries" class="pdf-data" data-label="Enquiries"></div>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleSection('sec4')">4. Applicant Details <span>â–¼</span></div>
                <div id="sec4" class="accordion-body">
                    <div class="form-grid">
                        <div class="form-group"><label>Applicant Age</label><input type="number" id="age" class="pdf-data" data-label="Age"></div>
                        <div class="form-group"><label>Gender</label><select class="pdf-data" data-label="Gender"><option>Male</option><option>Female</option></select></div>
                        <div class="form-group"><label>Marital Status</label><select class="pdf-data" data-label="Marital"><option>Married</option><option>Single</option></select></div>
                        
                        <div class="form-group"><label>Has Co-Applicant?</label>
                            <select onchange="toggleField('coAppField', this.value === 'Yes')"><option>No</option><option>Yes</option></select>
                        </div>
                        <div class="form-group hidden-field" id="coAppField"><label>Co-Applicant Age</label><input type="number" class="pdf-data" data-label="Co-App Age"></div>
                        
                        <div class="form-group"><label>Own House?</label>
                            <select onchange="toggleField('houseField', this.value === 'Yes')"><option>No</option><option>Yes</option></select>
                        </div>
                        <div class="form-group hidden-field" id="houseField"><label>Pincode</label><input type="number" class="pdf-data" data-label="House Pincode"></div>
                    </div>
                </div>
            </div>

            <div class="accordion">
                <div class="accordion-header" onclick="toggleSection('sec5')">5. Loan Requirement <span>â–¼</span></div>
                <div id="sec5" class="accordion-body">
                    <div class="form-grid">
                        <div class="form-group"><label>Required Amount (Lakhs)</label><input type="number" id="reqAmount" class="pdf-data" data-label="Req Amount"></div>
                        <div class="form-group"><label>Purpose</label><select id="purpose" class="pdf-data" data-label="Purpose"><option>Working Capital</option><option>Expansion</option><option>Asset Purchase</option></select></div>
                    </div>
                </div>
            </div>

            <button class="submit-btn" onclick="runEligibilityEngine()">âš¡ Check Eligibility (All Policies)</button>
            <button class="report-btn" id="dlReportBtn" onclick="generateFullPDF()">ðŸ“„ Download Full Report</button>
            <div id="resultsArea"></div>
        </div>

        <div class="right-panel">
            <div class="panel-title">ðŸ“‹ Active Policies</div>
            <div id="policySideList"></div>
        </div>

    </div>

    <div id="fullReportModal">
        <div class="report-paper">
            <div class="no-print" style="text-align:right; margin-bottom:10px;">
                <button onclick="document.getElementById('fullReportModal').style.display='none'" style="padding:10px;">Close</button>
                <button onclick="window.print()" style="padding:10px; background:#0288d1; color:white; border:none;">Print / Save PDF</button>
            </div>

            <div class="report-header">
                <div class="report-title">PROVISIONAL OFFER LETTER</div>
                <div style="font-size:18px; margin-top:10px; font-weight:bold;">Customer: <span id="pdfCustomerName"></span></div>
            </div>

            <div class="report-section-title">LOAN APPLICATION DETAILS</div>
            <div class="details-grid" id="pdfAppDetails"></div>

            <div class="report-section-title">ELIGIBILITY (ALL BANKS)</div>
            <table class="report-table">
                <thead><tr><th>Bank Name</th><th>Program Type</th><th>Approved Amount</th><th>Tenure</th><th>ROI</th></tr></thead>
                <tbody id="pdfEligibleTable"></tbody>
            </table>

            <div class="report-section-title">NOT ELIGIBLE</div>
            <table class="report-table">
                <thead><tr><th>Bank Name</th><th>Reject Program</th><th>Remarks</th><th>Final Status</th></tr></thead>
                <tbody id="pdfRejectTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // GLOBAL DATA
        let latestResults = { eligible: [], declined: [] };
        const bankPolicies = [
            { bank: "TATA CAPITAL STBL", type:"STBL", minVintage: 2, minCibil: 700, maxUnsecured: 2, roi: 18, maxTenure: 36, minTurnover: 20 },
            { bank: "ADITYA BIRLA STBL", type:"STBL", minVintage: 2, minCibil: 710, maxUnsecured: 2, roi: 17.5, maxTenure: 36, minTurnover: 25 },
            { bank: "BAJAJ FINANCE TERM", type:"TERM", minVintage: 3, minCibil: 720, maxUnsecured: 3, roi: 16.5, maxTenure: 48, minTurnover: 40 },
            { bank: "TATA CAPITAL HTBL", type:"HTBL", minVintage: 4, minCibil: 725, maxUnsecured: 4, roi: 14, maxTenure: 60, minTurnover: 200 }, 
            { bank: "PIRAMAL CAPITAL UBL", type:"UBL", minVintage: 3, minCibil: 700, maxUnsecured: 2, roi: 19, maxTenure: 36, minTurnover: 30 },
            { bank: "PIRAMAL CAPITAL UBL+", type:"UBL+", minVintage: 4, minCibil: 730, maxUnsecured: 1, roi: 15, maxTenure: 48, minTurnover: 100 },
            { bank: "ADITYA BIRLA DROP OD", type:"OD", minVintage: 3, minCibil: 740, maxUnsecured: 2, roi: 12, maxTenure: 12, minTurnover: 100 },
            { bank: "CLIX CAPITAL", type:"NBFC", minVintage: 2, minCibil: 680, maxUnsecured: 5, roi: 21, maxTenure: 30, minTurnover: 15 }
        ];

        // INIT LAYOUT
        window.onload = function() {
            const list = document.getElementById('policySideList');
            let html = "";
            bankPolicies.forEach(p => {
                let bg = "#eee";
                if(p.type === 'HTBL') bg = "#f3e5f5";
                if(p.type === 'OD') bg = "#e1f5fe";
                
                html += `<div class="policy-mini-card" style="background:${bg}">
                            <strong>${p.bank}</strong>
                            <div class="mini-stat"><span>Turnover:</span> <span>${p.minTurnover}L+</span></div>
                            <div class="mini-stat"><span>Min CIBIL:</span> <span>${p.minCibil}</span></div>
                            <div class="mini-stat"><span>ROI:</span> <span>${p.roi}%</span></div>
                         </div>`;
            });
            list.innerHTML = html;
        };

        // UI HELPERS
        function toggleSection(id) { const el = document.getElementById(id); el.style.display = (el.style.display === 'block') ? 'none' : 'block'; }
        function toggleField(id, show) { document.getElementById(id).style.display = show ? 'block' : 'none'; }
        function toggleBankOpt(el) { el.classList.toggle('selected'); }

        // ENGINE
        function calculatePV(rate, nper, pmt) {
            if (rate === 0) return pmt * nper;
            return pmt * (1 - Math.pow(1 + rate, -nper)) / rate;
        }

        function runEligibilityEngine() {
            latestResults = { eligible: [], declined: [] };
            
            // Inputs
            const vintage = parseFloat(document.getElementById('vintage').value) || 0;
            const turnover = (parseFloat(document.getElementById('turnover').value) || 0) * 100000;
            const turnoverLakhs = turnover / 100000;
            const sector = document.getElementById('sector').value;
            const abb = parseFloat(document.getElementById('abb').value) || 0;
            const cibil = parseFloat(document.getElementById('cibil').value) || 0;
            const unsecLoans = parseFloat(document.getElementById('unsecLoans').value) || 0;
            const currentEMI = parseFloat(document.getElementById('monthlyEmi').value) || 0;
            const reducedEMI = parseFloat(document.getElementById('reducedEmi').value) || 0;

            // Income
            let margin = (sector.includes('Manufacturing')) ? 0.09 : (sector.includes('Service') ? 0.11 : 0.07);
            const netIncome = Math.max(0, (turnover / 12 * margin) - Math.max(0, currentEMI - reducedEMI));

            bankPolicies.forEach(p => {
                let isEligible = true;
                let reasons = [];
                
                if (vintage < p.minVintage) { isEligible = false; reasons.push(`Vintage < ${p.minVintage} Yrs`); }
                if (cibil < p.minCibil) { isEligible = false; reasons.push(`CIBIL < ${p.minCibil}`); }
                if (unsecLoans > p.maxUnsecured) { isEligible = false; reasons.push(`Unsec > ${p.maxUnsecured}`); }
                if (turnoverLakhs < p.minTurnover) { isEligible = false; reasons.push(`Turnover < ${p.minTurnover}L`); }

                if (isEligible) {
                    const mRate = (p.roi/100)/12;
                    const loanABB = calculatePV(mRate, p.maxTenure, abb); 
                    const loanInc = calculatePV(mRate, p.maxTenure, netIncome);
                    
                    latestResults.eligible.push({
                        bank: p.bank,
                        prog: p.type + " (ABB/Income)",
                        amt: (Math.max(loanABB, loanInc)/100000).toFixed(2),
                        tenure: p.maxTenure,
                        roi: p.roi
                    });
                } else {
                    latestResults.declined.push({
                        bank: p.bank,
                        prog: p.type,
                        remarks: reasons.join(', '),
                        status: "DECLINED"
                    });
                }
            });

            document.getElementById('resultsArea').innerHTML = `<h3>Found ${latestResults.eligible.length} Eligible Offers</h3>`;
            document.getElementById('dlReportBtn').style.display = 'block';
        }

        function generateFullPDF() {
            document.getElementById('pdfCustomerName').innerText = document.getElementById('bizName').value || "Valued Customer";
            
            // Fill App Details
            const dGrid = document.getElementById('pdfAppDetails');
            dGrid.innerHTML = "";
            document.querySelectorAll('.pdf-data').forEach(inp => {
                if(inp.value && inp.value !== "0") {
                    dGrid.insertAdjacentHTML('beforeend', `<div class="detail-item"><span class="detail-label">${inp.getAttribute('data-label')}:</span> ${inp.value}</div>`);
                }
            });

            // Fill Eligible
            const eTable = document.getElementById('pdfEligibleTable');
            eTable.innerHTML = "";
            if(latestResults.eligible.length === 0) eTable.innerHTML = "<tr><td colspan='5'>No Eligible Banks</td></tr>";
            latestResults.eligible.forEach(i => {
                eTable.insertAdjacentHTML('beforeend', `<tr><td>${i.bank}</td><td>${i.prog}</td><td>â‚¹${i.amt} L</td><td>${i.tenure}m</td><td>${i.roi}%</td></tr>`);
            });

            // Fill Declined
            const dTable = document.getElementById('pdfRejectTable');
            dTable.innerHTML = "";
            if(latestResults.declined.length === 0) dTable.innerHTML = "<tr><td colspan='4'>No Rejections</td></tr>";
            latestResults.declined.forEach(i => {
                dTable.insertAdjacentHTML('beforeend', `<tr><td>${i.bank}</td><td>${i.prog}</td><td>${i.remarks}</td><td class="status-declined">${i.status}</td></tr>`);
            });

            document.getElementById('fullReportModal').style.display = 'block';
        }
    </script>
</body>
</html>
