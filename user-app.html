<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Credit Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- CORE STYLES --- */
        body { margin: 0; font-family: 'Roboto', sans-serif; background-color: #f0f2f5; display: flex; height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 260px; background-color: #1a237e; color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .logo { font-size: 22px; font-weight: bold; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px; margin-bottom: 8px; cursor: pointer; border-radius: 6px; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background-color: #3949ab; }
        .logout { margin-top: auto; background-color: #d32f2f; padding: 12px; text-align: center; border-radius: 6px; cursor: pointer; font-weight: bold; }

        /* Main Content */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header-title { font-size: 24px; color: #333; margin-bottom: 20px; font-weight: 700; }

        /* Form Sections (Accordion) */
        .accordion { background: white; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e0e0e0; }
        .accordion-header { padding: 18px 25px; font-weight: 600; color: #1a237e; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .accordion-header:hover { background-color: #f8f9fa; }
        .accordion-body { padding: 25px; display: none; border-top: 1px solid #eee; }
        .accordion-body.open { display: block; }

        /* Grid System */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
        .form-group { margin-bottom: 5px; }
        
        /* Inputs */
        label { display: block; margin-bottom: 6px; font-size: 13px; color: #555; font-weight: 500; }
        input, select { width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px; box-sizing: border-box; transition: 0.2s; }
        input:focus, select:focus { border-color: #1a237e; outline: none; box-shadow: 0 0 0 2px rgba(26, 35, 126, 0.1); }
        
        /* Special Fields */
        .hidden-field { display: none; }
        .add-field-btn { background: none; border: 1px dashed #1a237e; color: #1a237e; padding: 8px; width: 100%; margin-top: 15px; cursor: pointer; border-radius: 4px; font-size: 13px; }
        .add-field-btn:hover { background: #e8eaf6; }

        /* Bank Statement Buttons */
        .bank-options { display: flex; gap: 10px; flex-wrap: wrap; }
        .bank-opt { padding: 8px 15px; border: 1px solid #ddd; border-radius: 20px; cursor: pointer; font-size: 13px; user-select: none; }
        .bank-opt.selected { background-color: #1a237e; color: white; border-color: #1a237e; }

        /* Action Button */
        .submit-btn { width: 100%; padding: 16px; background-color: #2e7d32; color: white; font-size: 18px; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-top: 30px; box-shadow: 0 4px 10px rgba(46, 125, 50, 0.3); transition: 0.2s; }
        .submit-btn:hover { background-color: #1b5e20; transform: translateY(-1px); }

        /* Result Cards */
        #resultsArea { margin-top: 40px; }
        .result-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-left: 6px solid #ddd; }
        .result-card.approved { border-left-color: #2e7d32; }
        .result-card.declined { border-left-color: #d32f2f; }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .bank-logo { font-size: 18px; font-weight: 700; color: #333; }
        .status-badge { padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; color: white; text-transform: uppercase; }
        .bg-green { background: #2e7d32; }
        .bg-red { background: #d32f2f; }

        .program-row { display: flex; justify-content: space-between; background: #f9f9f9; padding: 12px; border-radius: 6px; margin-bottom: 8px; }
        .prog-name { font-weight: bold; color: #1a237e; font-size: 14px; }
        .prog-val { font-weight: bold; color: #333; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">üöÄ Loan Engine</div>
        <div class="nav-item active">üìÑ New Application</div>
        <div class="nav-item">‚öôÔ∏è Policies</div>
        <div class="logout">üö™ Logout</div>
    </div>

    <div class="main-content">
        <div class="header-title">Business Loan Eligibility Checker</div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleSection('sec1')">
                Section 1: Business Details <span>‚ñº</span>
            </div>
            <div id="sec1" class="accordion-body open">
                <div class="form-grid">
                    <div class="form-group"><label>Customer/Business Name</label><input type="text" id="bizName"></div>
                    <div class="form-group"><label>Business Vintage (Years)</label><input type="number" id="vintage" placeholder="e.g. 5"></div>
                    <div class="form-group"><label>Annual Turnover (‚Çπ Lakhs)</label><input type="number" id="turnover" placeholder="e.g. 100"></div>
                    
                    <div class="form-group"><label>Entity Type</label>
                        <select id="entityType">
                            <option value="Proprietorship">Proprietorship</option>
                            <option value="Partnership">Partnership</option>
                            <option value="LLP">LLP</option>
                            <option value="Pvt Ltd">Pvt Ltd</option>
                            <option value="Ltd">Ltd</option>
                        </select>
                    </div>

                    <div class="form-group"><label>Business Sector (Margin)</label>
                        <select id="sector">
                            <option value="Trading">Trading (7% Margin)</option>
                            <option value="Manufacturing">Manufacturing (9% Margin)</option>
                            <option value="Service">Service (11% Margin)</option>
                        </select>
                    </div>

                    <div class="form-group"><label>Premises Type</label>
                        <select id="premises">
                            <option value="Owned">Owned</option>
                            <option value="Rented">Rented</option>
                            <option value="Leased">Leased</option>
                        </select>
                    </div>
                </div>
                <button class="add-field-btn" onclick="addCustomField('sec1')">+ Add Field</button>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleSection('sec2')">
                Section 2: Banking & Docs <span>‚ñº</span>
            </div>
            <div id="sec2" class="accordion-body">
                <div class="form-grid">
                    <div class="form-group"><label>ABB (Average Bank Balance) ‚Çπ</label><input type="number" id="abb" placeholder="e.g. 50000"></div>
                    
                    <div class="form-group">
                        <label>Bank Statements Available</label>
                        <div class="bank-options">
                            <div class="bank-opt" onclick="toggleBankOpt(this, 'SA')">SA</div>
                            <div class="bank-opt" onclick="toggleBankOpt(this, 'CA')">CA</div>
                            <div class="bank-opt" onclick="toggleBankOpt(this, 'OD')">OD</div>
                            <div class="bank-opt" onclick="toggleBankOpt(this, 'CC')">CC</div>
                        </div>
                        <input type="hidden" id="selectedBankDocs">
                    </div>

                    <div class="form-group"><label>GST Registered?</label>
                        <select id="gstSelect" onchange="toggleField('gstDetails', this.value === 'Yes')">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group hidden-field" id="gstDetails"><label>GST Number</label><input type="text"></div>

                    <div class="form-group"><label>ITR Filed?</label>
                        <select id="itrSelect" onchange="toggleField('itrDetails', this.value === 'Yes')">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group hidden-field" id="itrDetails"><label>Latest ITR Amount</label><input type="number"></div>
                </div>
                <button class="add-field-btn" onclick="addCustomField('sec2')">+ Add Field</button>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleSection('sec3')">
                Section 3: Credit Profile <span>‚ñº</span>
            </div>
            <div id="sec3" class="accordion-body">
                <div class="form-grid">
                    <div class="form-group"><label>CIBIL Score</label><input type="number" id="cibil" placeholder="e.g. 750"></div>
                    <div class="form-group"><label>No. of Active Loans</label><input type="number" id="activeLoans" value="0"></div>
                    <div class="form-group"><label>Monthly EMI Obligation (‚Çπ)</label><input type="number" id="monthlyEmi" value="0"></div>
                    <div class="form-group"><label>No. of Unsecured Loans</label><input type="number" id="unsecLoans" value="0"></div>
                    <div class="form-group"><label>Loans Taken (Last 6m)</label><input type="number" id="loansTaken6m" value="0"></div>
                    <div class="form-group"><label>Loans Closing (Next 6m)</label><input type="number" id="loansClosed6m" value="0"></div>
                    <div class="form-group"><label>Reduced EMI (Next 6m) (‚Çπ)</label><input type="number" id="reducedEmi" value="0"></div>
                    <div class="form-group"><label>No. of Enquiries (Last 3m)</label><input type="number" id="enquiries" value="0"></div>
                </div>
                <button class="add-field-btn" onclick="addCustomField('sec3')">+ Add Field</button>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleSection('sec4')">
                Section 4: Applicant Details <span>‚ñº</span>
            </div>
            <div id="sec4" class="accordion-body">
                <div class="form-grid">
                    <div class="form-group"><label>Applicant Age</label><input type="number" id="age"></div>
                    <div class="form-group"><label>Gender</label><select id="gender"><option>Male</option><option>Female</option></select></div>
                    <div class="form-group"><label>Marital Status</label><select id="marital"><option>Single</option><option>Married</option><option>Divorced</option></select></div>
                    
                    <div class="form-group"><label>Has Co-Applicant?</label>
                        <select id="coAppSelect" onchange="toggleField('coAppField', this.value === 'Yes')">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group hidden-field" id="coAppField"><label>Co-Applicant Age</label><input type="number" id="coAppAge"></div>

                    <div class="form-group"><label>Own House?</label>
                        <select id="houseSelect" onchange="toggleField('houseField', this.value === 'Yes')">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group hidden-field" id="houseField"><label>Own House Pincode</label><input type="number" id="pincode"></div>
                </div>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleSection('sec5')">
                Section 5: Loan Requirement <span>‚ñº</span>
            </div>
            <div id="sec5" class="accordion-body">
                <div class="form-grid">
                    <div class="form-group"><label>Required Loan Amount (Lakhs)</label><input type="number" id="reqAmount"></div>
                    <div class="form-group"><label>Purpose of Loan</label>
                        <select id="purpose">
                            <option>Working Capital</option>
                            <option>Business Expansion</option>
                            <option>Asset Purchase</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <button class="submit-btn" onclick="runEligibilityEngine()">‚ö° Check Eligibility & Calculate Limits</button>

        <div id="resultsArea"></div>
    </div>

    <script>
        // --- UI LOGIC ---
        function toggleSection(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function toggleField(fieldId, show) {
            document.getElementById(fieldId).style.display = show ? 'block' : 'none';
        }

        function toggleBankOpt(el, val) {
            el.classList.toggle('selected');
            // Logic to update hidden input could go here
        }

        function addCustomField(sectionId) {
            const section = document.querySelector(`#${sectionId} .form-grid`);
            const div = document.createElement('div');
            div.className = 'form-group';
            div.innerHTML = `<label>New Field</label><input type="text" placeholder="Custom Value">`;
            section.appendChild(div);
        }

        // --- POLICY DATA (Saved Policies) ---
        const bankPolicies = [
            { 
                bank: "HDFC Bank", 
                minVintage: 3, 
                minCibil: 700, 
                maxUnsecured: 2, 
                maxEnquiries: 4, 
                roi: 18, // 18% p.a.
                maxTenure: 36 // months
            },
            { 
                bank: "Bajaj Finserv", 
                minVintage: 2, 
                minCibil: 680, 
                maxUnsecured: 4, 
                maxEnquiries: 6, 
                roi: 20, 
                maxTenure: 30
            },
            { 
                bank: "ICICI Bank", 
                minVintage: 4, 
                minCibil: 725, 
                maxUnsecured: 1, 
                maxEnquiries: 2, 
                roi: 16, 
                maxTenure: 48
            }
        ];

        // --- CALCULATION HELPERS ---
        
        // PV Formula: Calculates Loan Amount based on Monthly Capacity (EMI capability)
        // Rate = Monthly Rate (Annual/12/100)
        function calculatePV(rate, nper, pmt) {
            // Formula: PV = PMT * (1 - (1 + r)^-n) / r
            if (rate === 0) return pmt * nper;
            return pmt * (1 - Math.pow(1 + rate, -nper)) / rate;
        }

        function runEligibilityEngine() {
            // 1. GET DATA
            const vintage = parseFloat(document.getElementById('vintage').value) || 0;
            const turnover = (parseFloat(document.getElementById('turnover').value) || 0) * 100000; // Convert to absolute
            const sector = document.getElementById('sector').value;
            const abb = parseFloat(document.getElementById('abb').value) || 0;
            
            const cibil = parseFloat(document.getElementById('cibil').value) || 0;
            const unsecLoans = parseFloat(document.getElementById('unsecLoans').value) || 0;
            const enquiries = parseFloat(document.getElementById('enquiries').value) || 0;
            
            const currentEMI = parseFloat(document.getElementById('monthlyEmi').value) || 0;
            const reducedEMI = parseFloat(document.getElementById('reducedEmi').value) || 0;

            // 2. NET INCOME CALCULATION (DSCR PROGRAM)
            // Margins: Trading 7%, Mfg 9%, Service 11%
            let margin = 0.07;
            if (sector === 'Manufacturing') margin = 0.09;
            if (sector === 'Service') margin = 0.11;

            const monthlyTurnover = turnover / 12;
            const grossProfit = monthlyTurnover * margin;
            
            // Obligations except those closing in 6 months
            const actualObligation = Math.max(0, currentEMI - reducedEMI);
            
            // Net Disposable Income for Loan
            const netIncome = Math.max(0, grossProfit - actualObligation);

            // 3. ENGINE LOOP
            let html = `<h3>Calculation Results</h3>
                        <div style="background:#e3f2fd; padding:10px; border-radius:5px; margin-bottom:20px;">
                            <strong>Calculated Net Income:</strong> ‚Çπ${Math.round(netIncome).toLocaleString()} / month
                            <br><small>(Turnover Margin - Obligations)</small>
                        </div>`;

            bankPolicies.forEach(policy => {
                let reasons = [];
                let isEligible = true;

                // A. Check Rules
                if (vintage < policy.minVintage) { isEligible = false; reasons.push(`Vintage < ${policy.minVintage} yrs`); }
                if (cibil < policy.minCibil) { isEligible = false; reasons.push(`CIBIL < ${policy.minCibil}`); }
                if (unsecLoans > policy.maxUnsecured) { isEligible = false; reasons.push(`Unsecured Loans > ${policy.maxUnsecured}`); }
                if (enquiries > policy.maxEnquiries) { isEligible = false; reasons.push(`Too many enquiries`); }

                if (isEligible) {
                    // B. Calculate Limits (PV Formula)
                    const monthlyRate = (policy.roi / 100) / 12;

                    // Program 1: ABB
                    // Capacity = ABB amount
                    const loanABB = calculatePV(monthlyRate, policy.maxTenure, abb);

                    // Program 2: DSCR (Turnover)
                    // Capacity = Net Income
                    const loanDSCR = calculatePV(monthlyRate, policy.maxTenure, netIncome);

                    html += `
                    <div class="result-card approved">
                        <div class="card-header">
                            <span class="bank-logo">‚úÖ ${policy.bank}</span>
                            <span class="status-badge bg-green">Eligible</span>
                        </div>
                        
                        <div class="program-row">
                            <span class="prog-name">ABB Program</span>
                            <span class="prog-val">‚Çπ${(loanABB/100000).toFixed(2)} Lakhs</span>
                        </div>
                        <div style="font-size:11px; color:#666; margin-bottom:10px;">
                             Based on ABB ‚Çπ${abb.toLocaleString()} | ROI: ${policy.roi}% | Tenure: ${policy.maxTenure}m
                        </div>

                        <div class="program-row">
                            <span class="prog-name">DSCR (Turnover) Program</span>
                            <span class="prog-val">‚Çπ${(loanDSCR/100000).toFixed(2)} Lakhs</span>
                        </div>
                        <div style="font-size:11px; color:#666;">
                             Based on Net Income ‚Çπ${Math.round(netIncome).toLocaleString()}
                        </div>
                    </div>`;

                } else {
                    html += `
                    <div class="result-card declined">
                        <div class="card-header">
                            <span class="bank-logo">‚ùå ${policy.bank}</span>
                            <span class="status-badge bg-red">Declined</span>
                        </div>
                        <div style="color: #d32f2f; font-size:13px;">
                            <strong>Reasons:</strong> ${reasons.join(', ')}
                        </div>
                    </div>`;
                }
            });

            document.getElementById('resultsArea').innerHTML = html;
        }
    </script>
</body>
</html>
